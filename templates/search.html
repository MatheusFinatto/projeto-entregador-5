{% extends "layout.html" %} {% block title %} Results of search {% endblock %}
{% block content %}
<div>
  {% if not newJson["data"]%}
  <h1>Your search returned no results!</h1>
  {% else %}
  <h1>Results for "{{name}}"</h1>
  {% endif %}

  <div id="filters">
    <form id="rating_count_form" action="/search" method="get">
      <div class="form-container">
        <h5 id="filter-info">
          Filters*
          <span class="filters-tooltip"
            >Ifs no values were informed when the "filter" button is clicked,
            the default values of filter will be those of the placeholders
          </span>
        </h5>
        <div style="display: none">
          <label for="rating_count">Title: </label>
          <input type="text" id="name" name="name" value="{{ name }}" />
        </div>
        <div class="filter-field">
          <label for="rating_count">Minimum number of votes:</label>
          <input
            type="number"
            id="rating_count"
            name="rating_count"
            value="{{ rating_count }}"
            placeholder="1"
          />
        </div>
        <div class="filter-field">
          <label for="limit">Number of games displayed:</label>
          <input
            type="number"
            id="rating_count"
            name="limit"
            value="{{ limit }}"
            placeholder="20"
          />
        </div>
        <button type="submit">Filter</button>
      </div>
    </form>
    <div id="add-filters">
      <button onclick="showFilters(this)">Show filters</button>
    </div>
  </div>

  {% include 'game-card.html' %}
</div>

<script>
  // <!-- Star rating script-->
  //captures the json sent from python
  const json = JSON.parse("{{newJson|tojson}}");
  const starRatings = document.querySelectorAll(".rating");
  //for each game, gets the rating (in base 100) from the json, calculates the width of the stars based on this rating, and sets the style of the star-rating div based on it
  for (let i = 0; i < starRatings.length; i++) {
    if (json.data[i].rating) {
      const rating = json.data[i].rating.toFixed(2);
      //math explanation: each star has 25px; the number comes in base 100(i used toFixed(2) to avoid desnecessary math), but the stars are base 5; to turn to base 100 for base 5, the rating is divided by 20 and multipled by 25 witch is the star width.
      //E.G: if rating = 50, 40/20 = 2 * 25 = 50px of the div will be displayed. That ensures that stars are very precise.
      const starWidth = (rating / 20) * 25;
      starRatings[i].style.width = `${starWidth}px`;
    }
  }

  // <!-- Platforms script for "show more" button-->
  //when clicked, a show more button calls this function with "this.id" as param
  function showAllPlatforms(clicked_id) {
    //captures the <li> and <button> of the game, based on the id
    //the id's are ordered by "A + item.id" for <li> and "B + item.id" for <button>
    const platformListItems = document.querySelectorAll(
      `#${clicked_id.replace("A", "B")}`
    );
    const platformButtonShow = document.querySelector(`#${clicked_id}`);

    //iterates over all li's of the game, transforming their display from 'none' to 'flex'
    for (each of platformListItems) each.style.display = "flex";

    //transforms 'show-more-button' display from 'flex' to 'none'
    platformButtonShow.style.display = "none";

    //creates a new <li> (show-less-button li), appends html to it, gives it an 'onclick' event that reverts the action above and
    const newEl = document.createElement("li");
    newEl.innerHTML = `<button id = 'hide-all-platforms'><i id='plus-sign' class="fi fi-br-plus"></i></button><p class="platform-name">Show less</p> `;
    newEl.onclick = () => {
      for (each of platformListItems) each.style.display = "none";
      platformButtonShow.style.display = "flex";
      newEl.style.display = "none";
    };

    //appends the 'show less button li' to the last <li> of the game.
    platformListItems[platformListItems.length - 1].after(newEl);
  }
  function showFilters(button) {
    const rating_count_form = document.querySelector("#rating_count_form");
    rating_count_form.style.display = "flex";
    button.blur();
    button.innerText = "Hide filters";
    button.setAttribute("onclick", "hideFilters(this)");
  }

  function hideFilters(button) {
    const rating_count_form = document.querySelector("#rating_count_form");
    rating_count_form.style.display = "none";
    button.blur();
    button.innerText = "Show filters";
    button.setAttribute("onclick", "showFilters(this)");
  }
</script>
{% endblock %}
